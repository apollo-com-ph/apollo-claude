{
  "uid": "claude-code-overview",
  "title": "Claude Code Overview",
  "tags": ["claude-code", "otel"],
  "timezone": "browser",
  "refresh": "30s",
  "time": { "from": "now-24h", "to": "now" },
  "templating": {
    "list": [
      {
        "name": "user",
        "type": "query",
        "datasource": { "type": "loki", "uid": "loki" },
        "query": { "label": "user_email", "stream": "{service_name=\"claude-code\"}", "type": 1 },
        "includeAll": true,
        "allValue": ".*",
        "current": { "text": "All", "value": "$__all" },
        "refresh": 2,
        "multi": true
      },
      {
        "name": "model",
        "type": "query",
        "datasource": { "type": "loki", "uid": "loki" },
        "query": { "label": "model", "stream": "{service_name=\"claude-code\"}", "type": 1 },
        "includeAll": true,
        "allValue": ".*",
        "current": { "text": "All", "value": "$__all" },
        "refresh": 2,
        "multi": true
      },
      {
        "name": "tool",
        "type": "query",
        "datasource": { "type": "loki", "uid": "loki" },
        "query": { "label": "tool_name", "stream": "{service_name=\"claude-code\"}", "type": 1 },
        "includeAll": true,
        "allValue": ".*",
        "current": { "text": "All", "value": "$__all" },
        "refresh": 2,
        "multi": true
      }
    ]
  },
  "panels": [
    {
      "id": 100,
      "title": "",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "panels": [],
      "collapsed": false
    },
    {
      "id": 1,
      "title": "Total Cost (USD)",
      "type": "stat",
      "gridPos": { "h": 5, "w": 4, "x": 0, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum(sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap cost_usd [$__range]))",
        "legendFormat": "Cost"
      }],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "decimals": 2,
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 10 },
              { "color": "red", "value": 50 }
            ]
          }
        }
      }
    },
    {
      "id": 2,
      "title": "Total Sessions",
      "type": "stat",
      "gridPos": { "h": 5, "w": 4, "x": 4, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "count(sum by (session_id) (count_over_time({service_name=\"claude-code\", event_name=\"user_prompt\"} | user_email=~\"$user\" [$__range])))"
      }],
      "fieldConfig": { "defaults": { "noValue": "0", "thresholds": { "steps": [{ "color": "blue", "value": null }] } } }
    },
    {
      "id": 3,
      "title": "Total Prompts",
      "type": "stat",
      "gridPos": { "h": 5, "w": 4, "x": 8, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum(count_over_time({service_name=\"claude-code\", event_name=\"user_prompt\"} | user_email=~\"$user\" [$__range]))"
      }],
      "fieldConfig": { "defaults": { "noValue": "0", "thresholds": { "steps": [{ "color": "purple", "value": null }] } } }
    },
    {
      "id": 4,
      "title": "Total API Requests",
      "type": "stat",
      "gridPos": { "h": 5, "w": 4, "x": 12, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum(count_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" [$__range]))"
      }],
      "fieldConfig": { "defaults": { "noValue": "0", "thresholds": { "steps": [{ "color": "super-light-blue", "value": null }] } } }
    },
    {
      "id": 5,
      "title": "Total Tokens",
      "type": "stat",
      "gridPos": { "h": 5, "w": 4, "x": 16, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum(sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap input_tokens [$__range])) + sum(sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap output_tokens [$__range]))",
        "legendFormat": "Tokens"
      }],
      "fieldConfig": { "defaults": { "noValue": "0", "thresholds": { "steps": [{ "color": "orange", "value": null }] } } }
    },
    {
      "id": 6,
      "title": "API Errors",
      "type": "stat",
      "gridPos": { "h": 5, "w": 4, "x": 20, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum(count_over_time({service_name=\"claude-code\"} | event_name=\"api_error\" | user_email=~\"$user\" [$__range]))"
      }],
      "fieldConfig": { "defaults": { "noValue": "0", "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] } } }
    },

    {
      "id": 101,
      "title": "Cost & Tokens",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 6 },
      "panels": [],
      "collapsed": false
    },
    {
      "id": 10,
      "title": "Cost Over Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 7 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (user_email) (sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap cost_usd [$__interval]))",
        "legendFormat": "{{user_email}}"
      }],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "custom": { "fillOpacity": 20, "stacking": { "mode": "normal" } }
        }
      }
    },
    {
      "id": 11,
      "title": "Cost by Model Over Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 7 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (model) (sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap cost_usd [$__interval]))",
        "legendFormat": "{{model}}"
      }],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "custom": { "fillOpacity": 20, "stacking": { "mode": "normal" } }
        }
      }
    },
    {
      "id": 12,
      "title": "Token Usage Over Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 15 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "expr": "sum(sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap input_tokens [$__interval]))",
          "legendFormat": "Input"
        },
        {
          "expr": "sum(sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap output_tokens [$__interval]))",
          "legendFormat": "Output"
        },
        {
          "expr": "sum(sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap cache_read_tokens [$__interval]))",
          "legendFormat": "Cache Read"
        },
        {
          "expr": "sum(sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap cache_creation_tokens [$__interval]))",
          "legendFormat": "Cache Creation"
        }
      ],
      "fieldConfig": { "defaults": { "custom": { "fillOpacity": 10 } } }
    },
    {
      "id": 13,
      "title": "Token Usage by Model",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 15 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "expr": "sum by (model) (sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap input_tokens [$__interval]))",
          "legendFormat": "{{model}} input"
        },
        {
          "expr": "sum by (model) (sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap output_tokens [$__interval]))",
          "legendFormat": "{{model}} output"
        }
      ],
      "fieldConfig": { "defaults": { "custom": { "fillOpacity": 10 } } }
    },
    {
      "id": 14,
      "title": "Cost by User",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 23 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (user_email) (sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | unwrap cost_usd [$__range]))",
        "legendFormat": "{{user_email}}"
      }]
    },
    {
      "id": 15,
      "title": "Cost by Model",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 23 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (model) (sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | model=~\"$model\" | unwrap cost_usd [$__range]))",
        "legendFormat": "{{model}}"
      }]
    },
    {
      "id": 16,
      "title": "Tokens by User",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 23 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (user_email) (sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | unwrap input_tokens [$__range])) + sum by (user_email) (sum_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | unwrap output_tokens [$__range]))",
        "legendFormat": "{{user_email}}"
      }]
    },

    {
      "id": 102,
      "title": "API Performance",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 31 },
      "panels": [],
      "collapsed": false
    },
    {
      "id": 20,
      "title": "API Latency (ms)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 32 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "avg by (model) (avg_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap duration_ms [$__interval]))",
        "legendFormat": "{{model}}"
      }],
      "fieldConfig": { "defaults": { "unit": "ms", "custom": { "fillOpacity": 10 } } }
    },
    {
      "id": 21,
      "title": "API Latency by User (ms)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 32 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "avg by (user_email) (avg_over_time({service_name=\"claude-code\"} | event_name=\"api_request\" | user_email=~\"$user\" | model=~\"$model\" | unwrap duration_ms [$__interval]))",
        "legendFormat": "{{user_email}}"
      }],
      "fieldConfig": { "defaults": { "unit": "ms", "custom": { "fillOpacity": 10 } } }
    },
    {
      "id": 22,
      "title": "API Errors Over Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 40 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (status_code) (count_over_time({service_name=\"claude-code\"} | event_name=\"api_error\" | user_email=~\"$user\" [$__interval]))",
        "legendFormat": "HTTP {{status_code}}"
      }],
      "fieldConfig": {
        "defaults": {
          "custom": { "fillOpacity": 20, "drawStyle": "bars" },
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "id": 23,
      "title": "API Errors by Model",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 40 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (model) (count_over_time({service_name=\"claude-code\"} | event_name=\"api_error\" | user_email=~\"$user\" [$__interval]))",
        "legendFormat": "{{model}}"
      }],
      "fieldConfig": {
        "defaults": {
          "custom": { "fillOpacity": 20, "drawStyle": "bars" },
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "id": 24,
      "title": "API Error Log",
      "type": "table",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 48 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "{service_name=\"claude-code\"} | event_name=\"api_error\" | user_email=~\"$user\"",
        "refId": "A"
      }],
      "transformations": [
        {
          "id": "extractFields",
          "options": { "source": "labels", "keepTime": true }
        }
      ],
      "options": { "showHeader": true, "sortBy": [{ "displayName": "Time", "desc": true }] }
    },

    {
      "id": 103,
      "title": "Tool Usage",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 56 },
      "panels": [],
      "collapsed": false
    },
    {
      "id": 30,
      "title": "Tool Usage Over Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 57 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (tool_name) (count_over_time({service_name=\"claude-code\"} | event_name=\"tool_result\" | user_email=~\"$user\" | tool_name=~\"$tool\" [$__interval]))",
        "legendFormat": "{{tool_name}}"
      }],
      "fieldConfig": { "defaults": { "custom": { "fillOpacity": 20, "stacking": { "mode": "normal" } } } }
    },
    {
      "id": 31,
      "title": "Tool Success vs Failure",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 57 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "expr": "sum(count_over_time({service_name=\"claude-code\"} | event_name=\"tool_result\" | user_email=~\"$user\" | tool_name=~\"$tool\" | success=\"true\" [$__interval]))",
          "legendFormat": "Success"
        },
        {
          "expr": "sum(count_over_time({service_name=\"claude-code\"} | event_name=\"tool_result\" | user_email=~\"$user\" | tool_name=~\"$tool\" | success=\"false\" [$__interval]))",
          "legendFormat": "Failure"
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "fillOpacity": 20, "stacking": { "mode": "normal" } } },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Success" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Failure" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] }
        ]
      }
    },
    {
      "id": 32,
      "title": "Tool Failure Rate by Tool",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 65 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (tool_name) (count_over_time({service_name=\"claude-code\"} | event_name=\"tool_result\" | user_email=~\"$user\" | tool_name=~\"$tool\" | success=\"false\" [$__interval]))",
        "legendFormat": "{{tool_name}}"
      }],
      "fieldConfig": {
        "defaults": {
          "custom": { "fillOpacity": 20, "drawStyle": "bars" },
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "id": 33,
      "title": "Tool Execution Duration (ms)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 65 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "avg by (tool_name) (avg_over_time({service_name=\"claude-code\"} | event_name=\"tool_result\" | user_email=~\"$user\" | tool_name=~\"$tool\" | unwrap duration_ms [$__interval]))",
        "legendFormat": "{{tool_name}}"
      }],
      "fieldConfig": { "defaults": { "unit": "ms", "custom": { "fillOpacity": 10 } } }
    },
    {
      "id": 34,
      "title": "Tool Usage Distribution",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 73 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (tool_name) (count_over_time({service_name=\"claude-code\"} | event_name=\"tool_result\" | user_email=~\"$user\" | tool_name=~\"$tool\" [$__range]))",
        "legendFormat": "{{tool_name}}"
      }]
    },
    {
      "id": 35,
      "title": "Tool Usage by User",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 73 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (user_email) (count_over_time({service_name=\"claude-code\"} | event_name=\"tool_result\" | user_email=~\"$user\" | tool_name=~\"$tool\" [$__range]))",
        "legendFormat": "{{user_email}}"
      }]
    },
    {
      "id": 36,
      "title": "Tool Errors Log",
      "type": "logs",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 73 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "{service_name=\"claude-code\"} | event_name=\"tool_result\" | user_email=~\"$user\" | success=\"false\""
      }],
      "options": { "showTime": true, "sortOrder": "Descending", "enableLogDetails": true }
    },

    {
      "id": 104,
      "title": "Tool Decisions",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 81 },
      "panels": [],
      "collapsed": false
    },
    {
      "id": 40,
      "title": "Tool Decisions Over Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 82 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "expr": "sum(count_over_time({service_name=\"claude-code\"} | event_name=\"tool_decision\" | user_email=~\"$user\" | decision=\"accept\" [$__interval]))",
          "legendFormat": "Accepted"
        },
        {
          "expr": "sum(count_over_time({service_name=\"claude-code\"} | event_name=\"tool_decision\" | user_email=~\"$user\" | decision=\"reject\" [$__interval]))",
          "legendFormat": "Rejected"
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "fillOpacity": 20, "stacking": { "mode": "normal" } } },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Accepted" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Rejected" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] }
        ]
      }
    },
    {
      "id": 41,
      "title": "Tool Decisions by Tool",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 82 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (tool_name, decision) (count_over_time({service_name=\"claude-code\"} | event_name=\"tool_decision\" | user_email=~\"$user\" [$__interval]))",
        "legendFormat": "{{tool_name}} ({{decision}})"
      }],
      "fieldConfig": { "defaults": { "custom": { "fillOpacity": 20, "stacking": { "mode": "normal" } } } }
    },
    {
      "id": 42,
      "title": "Decision Source Distribution",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 90 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (source) (count_over_time({service_name=\"claude-code\"} | event_name=\"tool_decision\" | user_email=~\"$user\" [$__range]))",
        "legendFormat": "{{source}}"
      }]
    },
    {
      "id": 43,
      "title": "Tool Result Decision Source",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 90 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (source) (count_over_time({service_name=\"claude-code\"} | event_name=\"tool_result\" | user_email=~\"$user\" [$__range]))",
        "legendFormat": "{{source}}"
      }]
    },
    {
      "id": 44,
      "title": "Rejections by Tool",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 90 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (tool_name) (count_over_time({service_name=\"claude-code\"} | event_name=\"tool_decision\" | user_email=~\"$user\" | decision=\"reject\" [$__range]))",
        "legendFormat": "{{tool_name}}"
      }],
      "fieldConfig": { "defaults": { "noValue": "0", "color": { "mode": "palette-classic" } } },
      "options": { "orientation": "horizontal", "displayMode": "gradient" }
    },

    {
      "id": 105,
      "title": "User Activity",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 98 },
      "panels": [],
      "collapsed": false
    },
    {
      "id": 50,
      "title": "Prompts Over Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 99 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (user_email) (count_over_time({service_name=\"claude-code\"} | event_name=\"user_prompt\" | user_email=~\"$user\" [$__interval]))",
        "legendFormat": "{{user_email}}"
      }],
      "fieldConfig": { "defaults": { "custom": { "fillOpacity": 20, "stacking": { "mode": "normal" } } } }
    },
    {
      "id": 51,
      "title": "Prompt Length Over Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 99 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "expr": "avg(avg_over_time({service_name=\"claude-code\"} | event_name=\"user_prompt\" | user_email=~\"$user\" | unwrap prompt_length [$__interval]))",
          "legendFormat": "Avg Prompt Length"
        },
        {
          "expr": "max(max_over_time({service_name=\"claude-code\"} | event_name=\"user_prompt\" | user_email=~\"$user\" | unwrap prompt_length [$__interval]))",
          "legendFormat": "Max Prompt Length"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "short", "custom": { "fillOpacity": 10 } } }
    },
    {
      "id": 52,
      "title": "Prompts by User",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 107 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (user_email) (count_over_time({service_name=\"claude-code\"} | event_name=\"user_prompt\" | user_email=~\"$user\" [$__range]))",
        "legendFormat": "{{user_email}}"
      }]
    },
    {
      "id": 53,
      "title": "Sessions by User",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 107 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "count by (user_email) (sum by (user_email, session_id) (count_over_time({service_name=\"claude-code\", event_name=\"user_prompt\"} | user_email=~\"$user\" [$__range])))",
        "legendFormat": "{{user_email}}"
      }],
      "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" } } },
      "options": { "orientation": "horizontal", "displayMode": "gradient" }
    },
    {
      "id": 54,
      "title": "Terminal Type Distribution",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 107 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "sum by (terminal_type) (count_over_time({service_name=\"claude-code\"} | event_name=\"user_prompt\" | user_email=~\"$user\" [$__range]))",
        "legendFormat": "{{terminal_type}}"
      }]
    },

    {
      "id": 106,
      "title": "Events Log",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 115 },
      "panels": [],
      "collapsed": false
    },
    {
      "id": 60,
      "title": "All Events",
      "type": "logs",
      "gridPos": { "h": 12, "w": 24, "x": 0, "y": 116 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [{
        "expr": "{service_name=\"claude-code\"} | user_email=~\"$user\""
      }],
      "options": { "showTime": true, "sortOrder": "Descending", "enableLogDetails": true }
    }
  ],
  "schemaVersion": 39
}
